<div class="min-h-screen bg-dada-background-light dark:bg-dada-background-dark p-6">
  <div class="max-w-2xl mx-auto bg-dada-card-light dark:bg-dada-card-dark shadow-lg rounded-dada p-6 space-y-6">
    <h2 class="text-2xl font-bold text-dada-text-light dark:text-dada-text-dark mb-2">Create a New Share</h2>

    <%= form_with model: @share, url: web_shares_path, local: true do |f| %>

      <!-- ✅ Share Type -->
      <div class="mb-4">
        <%= f.label :share_type, "What would you like to share?", class: "block text-sm font-semibold text-dada-text-light dark:text-dada-text-dark mb-1" %>
        <%= f.select :share_type, Share::TYPES, {}, class: "block w-full mt-1 border border-gray-300 dark:border-zinc-600 bg-white dark:bg-zinc-700 text-dada-text-light dark:text-dada-text-dark rounded px-3 py-2" %>
      </div>

      <!-- ✅ Title -->
      <div class="mb-4">
        <%= f.label :title, class: "block text-sm font-medium text-dada-text-light dark:text-dada-text-dark" %>
        <%= f.text_field :title, class: "w-full mt-1 px-3 py-2 rounded border border-gray-300 dark:border-zinc-600 bg-white dark:bg-zinc-700 text-dada-text-light dark:text-dada-text-dark" %>
      </div>

      <!-- ✅ Content -->
      <div class="mb-4">
        <%= f.label :content, class: "block text-sm font-medium text-dada-text-light dark:text-dada-text-dark" %>
        <%= f.text_area :content, rows: 4, class: "w-full mt-1 px-3 py-2 rounded border border-gray-300 dark:border-zinc-600 bg-white dark:bg-zinc-700 text-dada-text-light dark:text-dada-text-dark" %>
      </div>

      <!-- ✅ Image URLs -->
      <div class="mb-4">
        <%= f.label :image_urls, "Image URLs (comma separated)", class: "block text-sm font-medium text-dada-text-light dark:text-dada-text-dark" %>
        <%= f.text_field :image_urls, class: "w-full mt-1 px-3 py-2 rounded border border-gray-300 dark:border-zinc-600 bg-white dark:bg-zinc-700 text-dada-text-light dark:text-dada-text-dark" %>
      </div>

      <!-- ✅ Video URL + Live Preview -->
      <div class="mb-4">
        <%= f.label :video_url, class: "block text-sm font-medium text-dada-text-light dark:text-dada-text-dark" %>
        <%= f.text_field :video_url, id: "video_url_field",
                         placeholder: "Paste YouTube link...",
                         class: "w-full mt-1 px-3 py-2 rounded border border-gray-300 dark:border-zinc-600 bg-white dark:bg-zinc-700 text-dada-text-light dark:text-dada-text-dark" %>
      </div>

      <div id="video-preview" class="hidden">
        <div class="relative w-full" style="padding-top: 56.25%;">
          <iframe id="video-iframe"
                  class="absolute top-0 left-0 w-full h-full rounded"
                  frameborder="0"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen></iframe>
        </div>
      </div>

      <!-- ✅ Visibility -->
      <div class="mb-4">
        <%= f.label :visibility, "Who can see this?", class: "block text-sm font-medium text-dada-text-light dark:text-dada-text-dark" %>
        <%= f.select :visibility,
                     [["Public (everyone)", Share.visibilities[:public]],
                      ["Forum only (private)", Share.visibilities[:private]]],
                     {},
                     class: "block w-full mt-1 border border-gray-300 dark:border-zinc-600 bg-white dark:bg-zinc-700 text-dada-text-light dark:text-dada-text-dark rounded px-3 py-2" %>
      </div>

      <%= f.submit "Share Now", class: "bg-dada-primary text-white font-semibold px-6 py-2 rounded hover:bg-dada-accent transition" %>
    <% end %>
  </div>
</div>

<!-- ✅ Add Turbo-safe video preview script -->
<script>
    document.addEventListener("turbo:load", () => {
        const videoInput = document.getElementById("video_url_field");
        const previewContainer = document.getElementById("video-preview");
        const iframe = document.getElementById("video-iframe");

        if (!videoInput) return;

        videoInput.addEventListener("input", () => {
            let url = videoInput.value.trim();
            if (!url) {
                previewContainer.classList.add("hidden");
                iframe.src = "";
                return;
            }

            let embedUrl = "";
            if (url.includes("youtube.com/watch?v=")) {
                embedUrl = url.replace("watch?v=", "embed/");
            } else if (url.includes("youtu.be/")) {
                embedUrl = url.replace("youtu.be/", "www.youtube.com/embed/");
            } else {
                previewContainer.classList.add("hidden");
                return;
            }

            iframe.src = embedUrl.startsWith("http") ? embedUrl : `https://${embedUrl}`;
            previewContainer.classList.remove("hidden");
        });
    });
</script>
