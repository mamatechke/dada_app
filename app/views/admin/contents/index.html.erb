<% content_for :page_title, "Content Management" %>

<div class="px-4 sm:px-0">
  <div class="sm:flex sm:items-center sm:justify-between mb-6">
    <div>
      <h3 class="text-lg leading-6 font-medium text-gray-900">Content Library</h3>
      <p class="mt-1 text-sm text-gray-500">Manage articles, guides, and resources</p>
    </div>
    <div class="mt-3 sm:mt-0">
      <%= link_to "Create New Content", new_admin_content_path, class: "inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-dada-primary hover:bg-dada-accent" %>
    </div>
  </div>

  <!-- Filters -->
  <div class="bg-white shadow rounded-lg p-4 mb-6">
    <%= form_with url: admin_contents_path, method: :get, class: "grid grid-cols-1 gap-4 sm:grid-cols-4" do |f| %>
      <div>
        <%= f.label :search, "Search", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.text_field :search, value: params[:search], placeholder: "Search by title...", class: "w-full rounded-md border-gray-300 shadow-sm focus:border-dada-primary focus:ring-dada-primary sm:text-sm" %>
      </div>

      <div>
        <%= f.label :status, "Status", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.select :status, [["All", ""], ["Published", "published"], ["Draft", "draft"]], { selected: params[:status] }, class: "w-full rounded-md border-gray-300 shadow-sm focus:border-dada-primary focus:ring-dada-primary sm:text-sm" %>
      </div>

      <div>
        <%= f.label :content_type, "Type", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.select :content_type, [["All", ""], ["Article", "article"], ["Guide", "guide"], ["Video", "video"], ["Tip", "tip"]], { selected: params[:content_type] }, class: "w-full rounded-md border-gray-300 shadow-sm focus:border-dada-primary focus:ring-dada-primary sm:text-sm" %>
      </div>

      <div class="flex items-end">
        <%= f.submit "Filter", class: "w-full px-4 py-2 bg-gray-100 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-200" %>
      </div>
    <% end %>
  </div>

  <!-- Content Table -->
  <div class="bg-white shadow rounded-lg overflow-hidden">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
            Title
          </th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
            Type
          </th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
            Status
          </th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
            Views
          </th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
            Created
          </th>
          <th scope="col" class="relative px-6 py-3">
            <span class="sr-only">Actions</span>
          </th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        <% @contents.each do |content| %>
          <tr>
            <td class="px-6 py-4">
              <div class="flex items-center">
                <div>
                  <div class="text-sm font-medium text-gray-900">
                    <%= link_to content.title, web_content_path(content), target: "_blank", class: "hover:text-dada-primary" %>
                  </div>
                  <% if content.stage_tags.present? %>
                    <div class="text-xs text-gray-500 mt-1">
                      <%= content.stage_tags.join(", ") %>
                    </div>
                  <% end %>
                </div>
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                <%= content.content_type&.capitalize || 'Article' %>
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <% if content.published %>
                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                  Published
                </span>
              <% else %>
                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">
                  Draft
                </span>
              <% end %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              <%= content.view_count || 0 %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              <%= content.created_at.strftime("%b %d, %Y") %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
              <%= link_to "Edit", edit_admin_content_path(content), class: "text-dada-primary hover:text-dada-accent mr-3" %>
              <%= link_to "Delete", admin_content_path(content), data: { turbo_method: :delete, turbo_confirm: "Are you sure?" }, class: "text-red-600 hover:text-red-900" %>
            </td>
          </tr>
        <% end %>

        <% if @contents.empty? %>
          <tr>
            <td colspan="6" class="px-6 py-12 text-center text-gray-500">
              <p class="text-lg">No content found.</p>
              <p class="mt-2 text-sm">
                <%= link_to "Create your first content â†’", new_admin_content_path, class: "text-dada-primary hover:text-dada-accent" %>
              </p>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
